{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\r\nimport { cookies } from 'next/headers';\r\n\r\nexport async function createClient() {\r\n    const cookieStore = await cookies();\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return cookieStore.getAll();\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    try {\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            cookieStore.set(name, value, options)\r\n                        );\r\n                    } catch {\r\n                        // Chamado de um Server Component - pode ignorar se for apenas leitura\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,iMAAO;IACjC,OAAO,IAAA,sPAAkB,sUAGrB;QACI,SAAS;YACL;gBACI,OAAO,YAAY,MAAM;YAC7B;YACA,QAAO,YAAY;gBACf,IAAI;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAErC,EAAE,OAAM;gBACJ,sEAAsE;gBAC1E;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/lib/auth.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server';\r\nimport { UserRole } from '@core/types';\r\n\r\nexport interface AppUser {\r\n    id: string;\r\n    email: string;\r\n    name: string;\r\n    role: UserRole;\r\n    tenantId: string;\r\n    studentId: string | null;\r\n}\r\n\r\n/**\r\n * Obtém o usuário atual autenticado e seus metadados do banco de dados (RBAC).\r\n */\r\nexport async function getCurrentUser(): Promise<AppUser | null> {\r\n    const supabase = await createClient();\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return null;\r\n\r\n    // 1. Tentar buscar por UID (já vinculado)\r\n    let { data: dbUser } = await supabase\r\n        .from('users')\r\n        .select('id, email, name, role, tenantId, studentId, supabaseUid')\r\n        .eq('supabaseUid', user.id)\r\n        .single();\r\n\r\n    // 2. Se não encontrou por UID, tentar por Email (Primeiro acesso)\r\n    if (!dbUser) {\r\n        const { data: matchedEmail } = await supabase\r\n            .from('users')\r\n            .select('id, email, name, role, tenantId, studentId, supabaseUid')\r\n            .eq('email', user.email)\r\n            .single();\r\n\r\n        if (matchedEmail) {\r\n            // Vincular o UID do Supabase ao registro no banco\r\n            const { data: updatedUser } = await supabase\r\n                .from('users')\r\n                .update({ supabaseUid: user.id })\r\n                .eq('id', matchedEmail.id)\r\n                .select()\r\n                .single();\r\n\r\n            dbUser = updatedUser;\r\n        }\r\n    }\r\n\r\n    if (!dbUser) return null;\r\n\r\n    return {\r\n        id: dbUser.id,\r\n        email: dbUser.email,\r\n        name: dbUser.name,\r\n        role: dbUser.role as UserRole,\r\n        tenantId: dbUser.tenantId,\r\n        studentId: dbUser.studentId,\r\n    };\r\n}\r\n\r\n/**\r\n * Mapeia cada Role para sua página inicial padrão.\r\n */\r\nconst ROLE_HOME: Record<string, string> = {\r\n    STUDENT: '/minhas-forcas',\r\n    TEACHER: '/turma',\r\n    PSYCHOLOGIST: '/alunos',\r\n    COUNSELOR: '/alunos',\r\n    MANAGER: '/turma',\r\n    ADMIN: '/super-admin',\r\n};\r\n\r\nexport function getHomeForRole(role: string): string {\r\n    return ROLE_HOME[role] ?? '/';\r\n}\r\n\r\n/**\r\n * Define quais permissões são necessárias para cada grupo de rotas.\r\n */\r\nconst ROUTE_ACCESS: Record<string, string[]> = {\r\n    '/questionario': ['STUDENT'],\r\n    '/minhas-forcas': ['STUDENT'],\r\n    '/turma': ['TEACHER', 'MANAGER', 'ADMIN'],\r\n    '/alunos': ['PSYCHOLOGIST', 'COUNSELOR', 'MANAGER', 'ADMIN'],\r\n    '/intervencoes': ['PSYCHOLOGIST', 'COUNSELOR', 'MANAGER', 'ADMIN'],\r\n    '/relatorios': ['PSYCHOLOGIST', 'COUNSELOR', 'MANAGER', 'ADMIN'],\r\n    '/gestao': ['MANAGER', 'ADMIN'],\r\n    '/super-admin': ['ADMIN'],\r\n};\r\n\r\n/**\r\n * Verifica se o usuário com determinado Role pode acessar a rota.\r\n */\r\nexport function canAccessRoute(role: string, pathname: string): boolean {\r\n    const matchedRoute = Object.keys(ROUTE_ACCESS).find(\r\n        (route) => pathname === route || pathname.startsWith(route + '/')\r\n    );\r\n    if (!matchedRoute) return true; // Rotas não mapeadas são tratadas como públicas dentro do portal\r\n    return ROUTE_ACCESS[matchedRoute].includes(role);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAeO,eAAe;IAClB,MAAM,WAAW,MAAM,IAAA,gMAAY;IACnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO;IAElB,0CAA0C;IAC1C,IAAI,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SACxB,IAAI,CAAC,SACL,MAAM,CAAC,2DACP,EAAE,CAAC,eAAe,KAAK,EAAE,EACzB,MAAM;IAEX,kEAAkE;IAClE,IAAI,CAAC,QAAQ;QACT,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,SACL,MAAM,CAAC,2DACP,EAAE,CAAC,SAAS,KAAK,KAAK,EACtB,MAAM;QAEX,IAAI,cAAc;YACd,kDAAkD;YAClD,MAAM,EAAE,MAAM,WAAW,EAAE,GAAG,MAAM,SAC/B,IAAI,CAAC,SACL,MAAM,CAAC;gBAAE,aAAa,KAAK,EAAE;YAAC,GAC9B,EAAE,CAAC,MAAM,aAAa,EAAE,EACxB,MAAM,GACN,MAAM;YAEX,SAAS;QACb;IACJ;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,OAAO;QACH,IAAI,OAAO,EAAE;QACb,OAAO,OAAO,KAAK;QACnB,MAAM,OAAO,IAAI;QACjB,MAAM,OAAO,IAAI;QACjB,UAAU,OAAO,QAAQ;QACzB,WAAW,OAAO,SAAS;IAC/B;AACJ;AAEA;;CAEC,GACD,MAAM,YAAoC;IACtC,SAAS;IACT,SAAS;IACT,cAAc;IACd,WAAW;IACX,SAAS;IACT,OAAO;AACX;AAEO,SAAS,eAAe,IAAY;IACvC,OAAO,SAAS,CAAC,KAAK,IAAI;AAC9B;AAEA;;CAEC,GACD,MAAM,eAAyC;IAC3C,iBAAiB;QAAC;KAAU;IAC5B,kBAAkB;QAAC;KAAU;IAC7B,UAAU;QAAC;QAAW;QAAW;KAAQ;IACzC,WAAW;QAAC;QAAgB;QAAa;QAAW;KAAQ;IAC5D,iBAAiB;QAAC;QAAgB;QAAa;QAAW;KAAQ;IAClE,eAAe;QAAC;QAAgB;QAAa;QAAW;KAAQ;IAChE,WAAW;QAAC;QAAW;KAAQ;IAC/B,gBAAgB;QAAC;KAAQ;AAC7B;AAKO,SAAS,eAAe,IAAY,EAAE,QAAgB;IACzD,MAAM,eAAe,OAAO,IAAI,CAAC,cAAc,IAAI,CAC/C,CAAC,QAAU,aAAa,SAAS,SAAS,UAAU,CAAC,QAAQ;IAEjE,IAAI,CAAC,cAAc,OAAO,MAAM,iEAAiE;IACjG,OAAO,YAAY,CAAC,aAAa,CAAC,QAAQ,CAAC;AAC/C"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/components/Sidebar.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Sidebar = registerClientReference(\n    function() { throw new Error(\"Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/Sistema de Gestão Socioemocional/components/Sidebar.tsx <module evaluation>\",\n    \"Sidebar\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,UAAU,IAAA,+TAAuB,EAC1C;IAAa,MAAM,IAAI,MAAM;AAA8N,GAC3P,mGACA","ignoreList":[0]}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/components/Sidebar.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Sidebar = registerClientReference(\n    function() { throw new Error(\"Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/Sistema de Gestão Socioemocional/components/Sidebar.tsx\",\n    \"Sidebar\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,UAAU,IAAA,+TAAuB,EAC1C;IAAa,MAAM,IAAI,MAAM;AAA8N,GAC3P,+EACA","ignoreList":[0]}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 169, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/components/NotificationBell.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const NotificationBell = registerClientReference(\n    function() { throw new Error(\"Attempted to call NotificationBell() from the server but NotificationBell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/Sistema de Gestão Socioemocional/components/NotificationBell.tsx <module evaluation>\",\n    \"NotificationBell\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,mBAAmB,IAAA,+TAAuB,EACnD;IAAa,MAAM,IAAI,MAAM;AAAgP,GAC7Q,4GACA","ignoreList":[0]}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/components/NotificationBell.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const NotificationBell = registerClientReference(\n    function() { throw new Error(\"Attempted to call NotificationBell() from the server but NotificationBell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/Sistema de Gestão Socioemocional/components/NotificationBell.tsx\",\n    \"NotificationBell\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,mBAAmB,IAAA,+TAAuB,EACnD;IAAa,MAAM,IAAI,MAAM;AAAgP,GAC7Q,wFACA","ignoreList":[0]}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/components/Header.tsx"],"sourcesContent":["import { NotificationBell } from './NotificationBell';\r\nimport { UserRole } from '@/src/core/types';\r\n\r\ninterface HeaderProps {\r\n    userName: string;\r\n    userRole: string;\r\n}\r\n\r\nexport function Header({ userName, userRole }: HeaderProps) {\r\n    const roleLabels: Record<string, string> = {\r\n        STUDENT: 'Aluno',\r\n        TEACHER: 'Professor',\r\n        PSYCHOLOGIST: 'Psicólogo',\r\n        COUNSELOR: 'Orientador',\r\n        MANAGER: 'Gestor',\r\n        ADMIN: 'Admin',\r\n    };\r\n\r\n    return (\r\n        <header className=\"h-16 border-b border-slate-200 bg-white/80 backdrop-blur-md sticky top-0 z-30 px-4 sm:px-6 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4 lg:hidden\">\r\n                {/* Espaço para o gatilho do sidebar mobile se necessário */}\r\n            </div>\r\n\r\n            <div className=\"hidden sm:block\">\r\n                <p className=\"text-[10px] font-bold text-slate-400 uppercase tracking-widest\">Bem-vindo(a)</p>\r\n                <p className=\"text-sm font-bold text-slate-700\">{userName}</p>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n                {(userRole === 'MANAGER' || userRole === 'PSYCHOLOGIST' || userRole === 'ADMIN') && (\r\n                    <NotificationBell />\r\n                )}\r\n\r\n                <div className=\"h-8 w-[1px] bg-slate-100 mx-2 hidden sm:block\" />\r\n\r\n                <div className=\"bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 flex items-center gap-2\">\r\n                    <div className=\"h-2 w-2 rounded-full bg-emerald-500 animate-pulse\" />\r\n                    <span className=\"text-[10px] font-black text-slate-600 uppercase tracking-tighter\">\r\n                        {roleLabels[userRole] || userRole}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n        </header>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAQO,SAAS,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAe;IACtD,MAAM,aAAqC;QACvC,SAAS;QACT,SAAS;QACT,cAAc;QACd,WAAW;QACX,SAAS;QACT,OAAO;IACX;IAEA,qBACI,qSAAC;QAAO,WAAU;;0BACd,qSAAC;gBAAI,WAAU;;;;;;0BAIf,qSAAC;gBAAI,WAAU;;kCACX,qSAAC;wBAAE,WAAU;kCAAiE;;;;;;kCAC9E,qSAAC;wBAAE,WAAU;kCAAoC;;;;;;;;;;;;0BAGrD,qSAAC;gBAAI,WAAU;;oBACV,CAAC,aAAa,aAAa,aAAa,kBAAkB,aAAa,OAAO,mBAC3E,qSAAC,0MAAgB;;;;;kCAGrB,qSAAC;wBAAI,WAAU;;;;;;kCAEf,qSAAC;wBAAI,WAAU;;0CACX,qSAAC;gCAAI,WAAU;;;;;;0CACf,qSAAC;gCAAK,WAAU;0CACX,UAAU,CAAC,SAAS,IAAI;;;;;;;;;;;;;;;;;;;;;;;;AAMjD"}},
    {"offset": {"line": 313, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/components/sidebar-nav.ts"],"sourcesContent":["import { LucideIcon } from 'lucide-react';\r\n\r\nexport interface NavItem {\r\n    label: string;\r\n    href: string;\r\n    iconName: string;\r\n}\r\n\r\nexport const NAV_BY_ROLE: Record<string, NavItem[]> = {\r\n    STUDENT: [\r\n        { label: 'Início', href: '/', iconName: 'Home' },\r\n        { label: 'Responder VIA', href: '/questionario', iconName: 'ClipboardList' },\r\n        { label: 'Minhas Forças', href: '/minhas-forcas', iconName: 'Trophy' },\r\n    ],\r\n    TEACHER: [\r\n        { label: 'Início', href: '/', iconName: 'Home' },\r\n        { label: 'Minha Turma', href: '/turma', iconName: 'LayoutDashboard' },\r\n        { label: 'Lançar Triagem', href: '/turma/triagem', iconName: 'ClipboardList' },\r\n    ],\r\n    PSYCHOLOGIST: [\r\n        { label: 'Início', href: '/', iconName: 'Home' },\r\n        { label: 'Mapa de Risco', href: '/turma', iconName: 'ClipboardList' },\r\n        { label: 'Lista de Alunos', href: '/alunos', iconName: 'Users' },\r\n        { label: 'Intervenções (C2)', href: '/intervencoes', iconName: 'Layers' },\r\n        { label: 'Relatórios', href: '/relatorios', iconName: 'FileText' },\r\n    ],\r\n    COUNSELOR: [\r\n        { label: 'Início', href: '/', iconName: 'Home' },\r\n        { label: 'Mapa de Risco', href: '/turma', iconName: 'ClipboardList' },\r\n        { label: 'Alunos', href: '/alunos', iconName: 'Users' },\r\n        { label: 'Intervenções (C2)', href: '/intervencoes', iconName: 'Layers' },\r\n    ],\r\n    MANAGER: [\r\n        { label: 'Início', href: '/', iconName: 'Home' },\r\n        { label: 'Gestão de Impacto', href: '/gestao', iconName: 'LayoutDashboard' },\r\n        { label: 'Mapa de Risco', href: '/turma', iconName: 'ClipboardList' },\r\n        { label: 'Alunos', href: '/alunos', iconName: 'Users' },\r\n        { label: 'Intervenções (C2)', href: '/intervencoes', iconName: 'Layers' },\r\n    ],\r\n    ADMIN: [\r\n        { label: 'Visão Geral', href: '/super-admin', iconName: 'Home' },\r\n        { label: 'Escolas', href: '/super-admin', iconName: 'School' }, // Placeholder href\r\n        { label: 'Financeiro', href: '/super-admin', iconName: 'CreditCard' }, // Placeholder href\r\n        { label: 'Usuários', href: '/alunos', iconName: 'Users' },\r\n        { label: 'Suporte', href: '/super-admin', iconName: 'LifeBuoy' }, // Placeholder href\r\n        { label: 'Configurações', href: '/super-admin', iconName: 'Settings' },\r\n    ],\r\n};\r\n\r\nexport function getNavForRole(role: string): NavItem[] {\r\n    return NAV_BY_ROLE[role] ?? [];\r\n}\r\n"],"names":[],"mappings":";;;;;;AAQO,MAAM,cAAyC;IAClD,SAAS;QACL;YAAE,OAAO;YAAU,MAAM;YAAK,UAAU;QAAO;QAC/C;YAAE,OAAO;YAAiB,MAAM;YAAiB,UAAU;QAAgB;QAC3E;YAAE,OAAO;YAAiB,MAAM;YAAkB,UAAU;QAAS;KACxE;IACD,SAAS;QACL;YAAE,OAAO;YAAU,MAAM;YAAK,UAAU;QAAO;QAC/C;YAAE,OAAO;YAAe,MAAM;YAAU,UAAU;QAAkB;QACpE;YAAE,OAAO;YAAkB,MAAM;YAAkB,UAAU;QAAgB;KAChF;IACD,cAAc;QACV;YAAE,OAAO;YAAU,MAAM;YAAK,UAAU;QAAO;QAC/C;YAAE,OAAO;YAAiB,MAAM;YAAU,UAAU;QAAgB;QACpE;YAAE,OAAO;YAAmB,MAAM;YAAW,UAAU;QAAQ;QAC/D;YAAE,OAAO;YAAqB,MAAM;YAAiB,UAAU;QAAS;QACxE;YAAE,OAAO;YAAc,MAAM;YAAe,UAAU;QAAW;KACpE;IACD,WAAW;QACP;YAAE,OAAO;YAAU,MAAM;YAAK,UAAU;QAAO;QAC/C;YAAE,OAAO;YAAiB,MAAM;YAAU,UAAU;QAAgB;QACpE;YAAE,OAAO;YAAU,MAAM;YAAW,UAAU;QAAQ;QACtD;YAAE,OAAO;YAAqB,MAAM;YAAiB,UAAU;QAAS;KAC3E;IACD,SAAS;QACL;YAAE,OAAO;YAAU,MAAM;YAAK,UAAU;QAAO;QAC/C;YAAE,OAAO;YAAqB,MAAM;YAAW,UAAU;QAAkB;QAC3E;YAAE,OAAO;YAAiB,MAAM;YAAU,UAAU;QAAgB;QACpE;YAAE,OAAO;YAAU,MAAM;YAAW,UAAU;QAAQ;QACtD;YAAE,OAAO;YAAqB,MAAM;YAAiB,UAAU;QAAS;KAC3E;IACD,OAAO;QACH;YAAE,OAAO;YAAe,MAAM;YAAgB,UAAU;QAAO;QAC/D;YAAE,OAAO;YAAW,MAAM;YAAgB,UAAU;QAAS;QAC7D;YAAE,OAAO;YAAc,MAAM;YAAgB,UAAU;QAAa;QACpE;YAAE,OAAO;YAAY,MAAM;YAAW,UAAU;QAAQ;QACxD;YAAE,OAAO;YAAW,MAAM;YAAgB,UAAU;QAAW;QAC/D;YAAE,OAAO;YAAiB,MAAM;YAAgB,UAAU;QAAW;KACxE;AACL;AAEO,SAAS,cAAc,IAAY;IACtC,OAAO,WAAW,CAAC,KAAK,IAAI,EAAE;AAClC"}},
    {"offset": {"line": 470, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/app/%28portal%29/layout.tsx"],"sourcesContent":["import { redirect } from 'next/navigation';\r\nimport { getCurrentUser, canAccessRoute } from '@/lib/auth';\r\nimport { Sidebar } from '@/components/Sidebar';\r\nimport { Header } from '@/components/Header';\r\nimport { getNavForRole } from '@/components/sidebar-nav';\r\nimport { headers } from 'next/headers';\r\n\r\nexport default async function PortalLayout({\r\n    children,\r\n}: {\r\n    children: React.ReactNode;\r\n}) {\r\n    const user = await getCurrentUser();\r\n\r\n    if (!user) {\r\n        redirect('/login');\r\n    }\r\n\r\n    // Obter o pathname atual para verificar permissão RBAC\r\n    // Nota: Next.js não fornece o pathname diretamente em Server Components,\r\n    // mas podemos passar através do middleware se necessário ou usar headers.\r\n    // Por simplicidade aqui, confiamos no middleware para a proteção básica\r\n    // e no canAccessRoute para lógica de renderização se necessário.\r\n\r\n    const navItems = getNavForRole(user.role);\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-screen overflow-hidden lg:flex-row bg-slate-50\">\r\n            <Sidebar\r\n                items={navItems}\r\n                userName={user.name}\r\n                userRole={user.role}\r\n            />\r\n\r\n            <main className=\"flex-1 flex flex-col min-h-0 pt-16 lg:pt-0 overflow-y-auto\">\r\n                <Header\r\n                    userName={user.name}\r\n                    userRole={user.role}\r\n                />\r\n\r\n                <div className=\"p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto w-full\">\r\n                    {children}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;AAGe,eAAe,aAAa,EACvC,QAAQ,EAGX;IACG,MAAM,OAAO,MAAM,IAAA,oLAAc;IAEjC,IAAI,CAAC,MAAM;QACP,IAAA,wPAAQ,EAAC;IACb;IAEA,uDAAuD;IACvD,yEAAyE;IACzE,0EAA0E;IAC1E,wEAAwE;IACxE,iEAAiE;IAEjE,MAAM,WAAW,IAAA,oMAAa,EAAC,KAAK,IAAI;IAExC,qBACI,qSAAC;QAAI,WAAU;;0BACX,qSAAC,wLAAO;gBACJ,OAAO;gBACP,UAAU,KAAK,IAAI;gBACnB,UAAU,KAAK,IAAI;;;;;;0BAGvB,qSAAC;gBAAK,WAAU;;kCACZ,qSAAC,sLAAM;wBACH,UAAU,KAAK,IAAI;wBACnB,UAAU,KAAK,IAAI;;;;;;kCAGvB,qSAAC;wBAAI,WAAU;kCACV;;;;;;;;;;;;;;;;;;AAKrB"}}]
}