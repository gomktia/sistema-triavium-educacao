{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\r\nimport { cookies } from 'next/headers';\r\n\r\nexport async function createClient() {\r\n    const cookieStore = await cookies();\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return cookieStore.getAll();\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    try {\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            cookieStore.set(name, value, options)\r\n                        );\r\n                    } catch {\r\n                        // Chamado de um Server Component - pode ignorar se for apenas leitura\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,iMAAO;IACjC,OAAO,IAAA,sPAAkB,sUAGrB;QACI,SAAS;YACL;gBACI,OAAO,YAAY,MAAM;YAC7B;YACA,QAAO,YAAY;gBACf,IAAI;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAErC,EAAE,OAAM;gBACJ,sEAAsE;gBAC1E;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/lib/auth.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server';\r\nimport { UserRole } from '@core/types';\r\n\r\nexport interface AppUser {\r\n    id: string;\r\n    email: string;\r\n    name: string;\r\n    role: UserRole;\r\n    tenantId: string;\r\n    studentId: string | null;\r\n}\r\n\r\n/**\r\n * Obtém o usuário atual autenticado e seus metadados do banco de dados (RBAC).\r\n */\r\nexport async function getCurrentUser(): Promise<AppUser | null> {\r\n    const supabase = await createClient();\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) return null;\r\n\r\n    // 1. Tentar buscar por UID (já vinculado)\r\n    let { data: dbUser } = await supabase\r\n        .from('users')\r\n        .select('id, email, name, role, tenantId, studentId, supabaseUid')\r\n        .eq('supabaseUid', user.id)\r\n        .single();\r\n\r\n    // 2. Se não encontrou por UID, tentar por Email (Primeiro acesso)\r\n    if (!dbUser) {\r\n        const { data: matchedEmail } = await supabase\r\n            .from('users')\r\n            .select('id, email, name, role, tenantId, studentId, supabaseUid')\r\n            .eq('email', user.email)\r\n            .single();\r\n\r\n        if (matchedEmail) {\r\n            // Vincular o UID do Supabase ao registro no banco\r\n            const { data: updatedUser } = await supabase\r\n                .from('users')\r\n                .update({ supabaseUid: user.id })\r\n                .eq('id', matchedEmail.id)\r\n                .select()\r\n                .single();\r\n\r\n            dbUser = updatedUser;\r\n        }\r\n    }\r\n\r\n    if (!dbUser) return null;\r\n\r\n    return {\r\n        id: dbUser.id,\r\n        email: dbUser.email,\r\n        name: dbUser.name,\r\n        role: dbUser.role as UserRole,\r\n        tenantId: dbUser.tenantId,\r\n        studentId: dbUser.studentId,\r\n    };\r\n}\r\n\r\n/**\r\n * Mapeia cada Role para sua página inicial padrão.\r\n */\r\nconst ROLE_HOME: Record<string, string> = {\r\n    STUDENT: '/minhas-forcas',\r\n    TEACHER: '/turma',\r\n    PSYCHOLOGIST: '/alunos',\r\n    COUNSELOR: '/alunos',\r\n    MANAGER: '/turma',\r\n    ADMIN: '/super-admin',\r\n};\r\n\r\nexport function getHomeForRole(role: string): string {\r\n    return ROLE_HOME[role] ?? '/';\r\n}\r\n\r\n/**\r\n * Define quais permissões são necessárias para cada grupo de rotas.\r\n */\r\nconst ROUTE_ACCESS: Record<string, string[]> = {\r\n    '/questionario': ['STUDENT'],\r\n    '/minhas-forcas': ['STUDENT'],\r\n    '/turma': ['TEACHER', 'MANAGER', 'ADMIN'],\r\n    '/alunos': ['PSYCHOLOGIST', 'COUNSELOR', 'MANAGER', 'ADMIN'],\r\n    '/intervencoes': ['PSYCHOLOGIST', 'COUNSELOR', 'MANAGER', 'ADMIN'],\r\n    '/relatorios': ['PSYCHOLOGIST', 'COUNSELOR', 'MANAGER', 'ADMIN'],\r\n    '/gestao': ['MANAGER', 'ADMIN'],\r\n    '/super-admin': ['ADMIN'],\r\n};\r\n\r\n/**\r\n * Verifica se o usuário com determinado Role pode acessar a rota.\r\n */\r\nexport function canAccessRoute(role: string, pathname: string): boolean {\r\n    const matchedRoute = Object.keys(ROUTE_ACCESS).find(\r\n        (route) => pathname === route || pathname.startsWith(route + '/')\r\n    );\r\n    if (!matchedRoute) return true; // Rotas não mapeadas são tratadas como públicas dentro do portal\r\n    return ROUTE_ACCESS[matchedRoute].includes(role);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAeO,eAAe;IAClB,MAAM,WAAW,MAAM,IAAA,gMAAY;IACnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO;IAElB,0CAA0C;IAC1C,IAAI,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SACxB,IAAI,CAAC,SACL,MAAM,CAAC,2DACP,EAAE,CAAC,eAAe,KAAK,EAAE,EACzB,MAAM;IAEX,kEAAkE;IAClE,IAAI,CAAC,QAAQ;QACT,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,SACL,MAAM,CAAC,2DACP,EAAE,CAAC,SAAS,KAAK,KAAK,EACtB,MAAM;QAEX,IAAI,cAAc;YACd,kDAAkD;YAClD,MAAM,EAAE,MAAM,WAAW,EAAE,GAAG,MAAM,SAC/B,IAAI,CAAC,SACL,MAAM,CAAC;gBAAE,aAAa,KAAK,EAAE;YAAC,GAC9B,EAAE,CAAC,MAAM,aAAa,EAAE,EACxB,MAAM,GACN,MAAM;YAEX,SAAS;QACb;IACJ;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,OAAO;QACH,IAAI,OAAO,EAAE;QACb,OAAO,OAAO,KAAK;QACnB,MAAM,OAAO,IAAI;QACjB,MAAM,OAAO,IAAI;QACjB,UAAU,OAAO,QAAQ;QACzB,WAAW,OAAO,SAAS;IAC/B;AACJ;AAEA;;CAEC,GACD,MAAM,YAAoC;IACtC,SAAS;IACT,SAAS;IACT,cAAc;IACd,WAAW;IACX,SAAS;IACT,OAAO;AACX;AAEO,SAAS,eAAe,IAAY;IACvC,OAAO,SAAS,CAAC,KAAK,IAAI;AAC9B;AAEA;;CAEC,GACD,MAAM,eAAyC;IAC3C,iBAAiB;QAAC;KAAU;IAC5B,kBAAkB;QAAC;KAAU;IAC7B,UAAU;QAAC;QAAW;QAAW;KAAQ;IACzC,WAAW;QAAC;QAAgB;QAAa;QAAW;KAAQ;IAC5D,iBAAiB;QAAC;QAAgB;QAAa;QAAW;KAAQ;IAClE,eAAe;QAAC;QAAgB;QAAa;QAAW;KAAQ;IAChE,WAAW;QAAC;QAAW;KAAQ;IAC/B,gBAAgB;QAAC;KAAQ;AAC7B;AAKO,SAAS,eAAe,IAAY,EAAE,QAAgB;IACzD,MAAM,eAAe,OAAO,IAAI,CAAC,cAAc,IAAI,CAC/C,CAAC,QAAU,aAAa,SAAS,SAAS,UAAU,CAAC,QAAQ;IAEjE,IAAI,CAAC,cAAc,OAAO,MAAM,iEAAiE;IACjG,OAAO,YAAY,CAAC,aAAa,CAAC,QAAQ,CAAC;AAC/C"}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/app/marketing/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Downloads/Sistema de Gestão Socioemocional/app/marketing/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/Sistema de Gestão Socioemocional/app/marketing/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,+TAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAqU,GAClW,mGACA","ignoreList":[0]}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/app/marketing/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Downloads/Sistema de Gestão Socioemocional/app/marketing/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Downloads/Sistema de Gestão Socioemocional/app/marketing/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,+TAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAiT,GAC9U,+EACA","ignoreList":[0]}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Yoda/Downloads/Sistema%20de%20Gest%C3%A3o%20Socioemocional/app/page.tsx"],"sourcesContent":["import { redirect } from 'next/navigation';\r\nimport { getCurrentUser, getHomeForRole } from '@/lib/auth';\r\nimport LandingPage from './marketing/page';\r\n\r\nexport default async function Home() {\r\n    const user = await getCurrentUser();\r\n\r\n    if (user) {\r\n        const homePath = getHomeForRole(user.role);\r\n        redirect(homePath);\r\n    }\r\n\r\n    return <LandingPage />;\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AACA;AACA;;;;;AAEe,eAAe;IAC1B,MAAM,OAAO,MAAM,IAAA,oLAAc;IAEjC,IAAI,MAAM;QACN,MAAM,WAAW,IAAA,oLAAc,EAAC,KAAK,IAAI;QACzC,IAAA,wPAAQ,EAAC;IACb;IAEA,qBAAO,qSAAC,2LAAW;;;;;AACvB"}}]
}